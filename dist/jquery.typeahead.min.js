/*!
 * jQuery Typeahead
 * Copyright (C) 2016 RunningCoder.org
 * Licensed under the MIT license
 *
 * @author Tom Bertrand
 * @version 2.3.4 (2016-3-25)
 * @link http://www.runningcoder.org/jquerytypeahead/
 */
!function(t){"function"==typeof define&&define.amd?define("jquery-typeahead",["jquery"],t()):"object"==typeof module&&module.exports?module.exports=function(e,i){return void 0===i&&(i="undefined"!=typeof window?require("jquery"):require("jquery")(e)),t(e,i)}:t(window,jQuery)}(function(t,e){"use strict";t.Typeahead={version:"2.3.4"};var i={input:null,minLength:2,maxItem:8,dynamic:!1,delay:300,order:null,offset:!1,hint:!1,accent:!1,highlight:!0,group:!1,groupOrder:null,maxItemPerGroup:null,dropdownFilter:!1,dynamicFilter:null,backdrop:!1,backdropOnFocus:!1,cache:!1,ttl:36e5,compression:!1,suggestion:!1,searchOnFocus:!1,resultContainer:null,generateOnLoad:null,mustSelectItem:!1,href:null,display:["display"],template:null,correlativeTemplate:!1,emptyTemplate:!1,filter:!0,matcher:null,source:null,callback:{onInit:null,onReady:null,onShowLayout:null,onHideLayout:null,onSearch:null,onResult:null,onLayoutBuiltBefore:null,onLayoutBuiltAfter:null,onNavigateBefore:null,onNavigateAfter:null,onMouseEnter:null,onMouseLeave:null,onClickBefore:null,onClickAfter:null,onSendRequest:null,onReceiveRequest:null,onPopulateSource:null,onCacheSave:null,onSubmit:null},selector:{container:"typeahead-container",result:"typeahead-result",list:"typeahead-list",group:"typeahead-group",item:"typeahead-item",empty:"typeahead-empty",display:"typeahead-display",query:"typeahead-query",filter:"typeahead-filter",filterButton:"typeahead-filter-button",filterValue:"typeahead-filter-value",dropdown:"typeahead-dropdown",dropdownCaret:"typeahead-caret",button:"typeahead-button",backdrop:"typeahead-backdrop",hint:"typeahead-hint"},debug:!1},o=".typeahead",s={from:"ãàáäâẽèéëêìíïîõòóöôùúüûñç",to:"aaaaaeeeeeiiiiooooouuuunc"},n=~t.navigator.appVersion.indexOf("MSIE 9."),r=function(t,e){this.rawQuery="",this.query=t.val()||"",this.tmpSource={},this.source={},this.isGenerated=null,this.generatedGroupCount=0,this.groupCount=0,this.groupBy="group",this.result={},this.resultHtml=null,this.resultCount=0,this.resultCountPerGroup={},this.options=e,this.node=t,this.container=null,this.resultContainer=null,this.item=null,this.xhr={},this.hintIndex=null,this.filters={dropdown:{},dynamic:{}},this.requests={},this.backdrop={},this.hint={},this.__construct()};r.prototype={extendOptions:function(){this.options.dynamic&&(this.options.cache=!1,this.options.compression=!1),this.options.cache&&(this.options.cache=function(e){var i,o=["localStorage","sessionStorage"];if(e===!0)e="localStorage";else if("string"==typeof e&&!~o.indexOf(e))return!1;i="undefined"!=typeof t[e];try{t[e].setItem("typeahead","typeahead"),t[e].removeItem("typeahead")}catch(s){i=!1}return i&&e||!1}.call(this,this.options.cache)),this.options.compression&&("object"==typeof LZString&&this.options.cache||(this.options.compression=!1)),"undefined"==typeof this.options.maxItem||/^\d+$/.test(this.options.maxItem)&&0!==this.options.maxItem||(this.options.maxItem=1/0),this.options.maxItemPerGroup&&!/^\d+$/.test(this.options.maxItemPerGroup)&&(this.options.maxItemPerGroup=null),!this.options.display||this.options.display instanceof Array||(this.options.display=[this.options.display]),!this.options.group||this.options.group instanceof Array||(this.options.group=[this.options.group]),this.options.highlight&&!~["any",!0].indexOf(this.options.highlight)&&(this.options.highlight=!1),!this.options.dynamicFilter||this.options.dynamicFilter instanceof Array||(this.options.dynamicFilter=[this.options.dynamicFilter]),this.options.accent&&("object"==typeof this.options.accent?this.options.accent.from&&this.options.accent.to&&this.options.accent.from.length===this.options.accent.to.length:this.options.accent=s),this.options.resultContainer&&("string"==typeof this.options.resultContainer&&(this.options.resultContainer=e(this.options.resultContainer)),this.options.resultContainer instanceof jQuery&&this.options.resultContainer[0]&&(this.resultContainer=this.options.resultContainer)),this.options.group&&"string"==typeof this.options.group[0]&&this.options.maxItemPerGroup&&(this.groupBy=this.options.group[0]),this.options.callback&&this.options.callback.onClick&&(this.options.callback.onClickBefore=this.options.callback.onClick,delete this.options.callback.onClick),this.options.callback&&this.options.callback.onNavigate&&(this.options.callback.onNavigateBefore=this.options.callback.onNavigate,delete this.options.callback.onNavigate),this.options=e.extend(!0,{},i,this.options)},unifySourceFormat:function(){if(this.options.source instanceof Array)return this.options.source={group:{data:this.options.source}},this.groupCount+=1,!0;("undefined"!=typeof this.options.source.data||"undefined"!=typeof this.options.source.url)&&(this.options.source={group:this.options.source});var t;for(var e in this.options.source)if(this.options.source.hasOwnProperty(e)){if(t=this.options.source[e],("string"==typeof t||t instanceof Array)&&(t={url:t}),!t.data&&!t.url)return!1;!t.display||t.display instanceof Array||(t.display=[t.display]),t.ignore&&(t.ignore instanceof RegExp||delete t.ignore),this.options.source[e]=t,this.groupCount+=1}return!0},init:function(){this.helper.executeCallback.call(this,this.options.callback.onInit,[this.node]),this.container=this.node.closest("."+this.options.selector.container)},delegateEvents:function(){var t=this,i=["focus"+o,"input"+o,"propertychange"+o,"keydown"+o,"keyup"+o,"dynamic"+o,"generateOnLoad"+o];this.container.off(o).on("click"+o+" touchstart"+o,function(i){t.options.dropdownFilter&&t.container.hasClass("filter")&&!e(i.target).closest("."+t.options.selector.dropdown.replace(" ","."))[0]&&t.container.removeClass("filter")}),this.node.closest("form").on("submit",function(e){return t.options.mustSelectItem&&t.helper.isEmpty(t.item)?void e.preventDefault():(t.options.backdropOnFocus||t.hideLayout(),t.options.callback.onSubmit?t.helper.executeCallback.call(t,t.options.callback.onSubmit,[t.node,this,t.item,e]):void 0)});var s=!1;this.node.off(o).on(i.join(" "),function(e){switch(e.type){case"focus":t.options.backdropOnFocus&&(t.buildBackdropLayout(),t.showLayout());case"generateOnLoad":null===t.isGenerated&&t.generateSource(),t.options.searchOnFocus&&t.query.length>=t.options.minLength&&t.isGenerated&&t.showLayout();case"keydown":e.keyCode&&~[9,13,27,38,39,40].indexOf(e.keyCode)&&(s=!0,t.navigate(e));break;case"keyup":null!==t.isGenerated||t.options.dynamic||t.generateSource(),n&&t.node[0].value.replace(/^\s+/,"").toString().length<t.query.length&&t.node.trigger("input"+o);break;case"propertychange":if(s){s=!1;break}case"input":if(t.rawQuery=t.node[0].value.toString(),t.query=t.rawQuery.replace(/^\s+/,""),t.options.hint&&t.hint.container&&""!==t.hint.container.val()&&0!==t.hint.container.val().indexOf(t.rawQuery)&&t.hint.container.val(""),t.options.dynamic)return t.isGenerated=null,void t.helper.typeWatch(function(){t.query.length>=t.options.minLength?t.generateSource():t.hideLayout()},t.options.delay);case"dynamic":if(!t.isGenerated)break;t.searchResult(),t.buildLayout(),(t.result.length>0||t.options.emptyTemplate)&&t.query.length>=t.options.minLength?t.showLayout():t.hideLayout()}}),this.options.generateOnLoad&&this.node.trigger("generateOnLoad"+o)},generateSource:function(){if(!this.isGenerated||this.options.dynamic){if(this.generatedGroupCount=0,this.isGenerated=!1,!this.helper.isEmpty(this.xhr)){for(var e in this.xhr)this.xhr.hasOwnProperty(e)&&this.xhr[e].abort();this.xhr={}}var i,o,s,n;for(i in this.options.source)if(this.options.source.hasOwnProperty(i)){if(o=this.options.source[i],this.options.cache&&(s=t[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+i))){this.options.compression&&(s=LZString.decompressFromUTF16(s)),n=!1;try{s=JSON.parse(s+""),s.data&&s.ttl>(new Date).getTime()?(this.populateSource(s.data,i),n=!0):t[this.options.cache].removeItem("TYPEAHEAD_"+this.node.selector+":"+i)}catch(r){}if(n)continue}!o.data||o.url?o.url&&(this.requests[i]||(this.requests[i]=this.generateRequestObject(i))):this.populateSource("function"==typeof o.data&&o.data()||o.data,i)}this.handleRequests()}},generateRequestObject:function(t){var i=this,o=this.options.source[t];o.url instanceof Array||(o.url=[o.url]);var s={request:{url:null,dataType:"json",beforeSend:function(e,s){i.xhr[t]=e;var n=i.requests[t].extra.beforeSend||o.url[0].beforeSend;"function"==typeof n&&n.apply(null,arguments)}},extra:{path:null,group:t,callback:{done:null,fail:null,complete:null,always:null}},validForGroup:[t]};Object.defineProperty(s.request,"beforeSend",{writable:!1}),o.url[0]instanceof Object?(o.url[0].callback&&(s.extra.callback=o.url[0].callback,delete o.url[0].callback),s.request=e.extend(!0,s.request,o.url[0])):"string"==typeof o.url[0]&&(s.request.url=o.url[0]),o.url[1]&&"string"==typeof o.url[1]&&(s.extra.path=o.url[1]),"jsonp"===s.request.dataType.toLowerCase()&&(s.request.jsonpCallback="callback_"+t);var n;for(var r in this.requests)if(this.requests.hasOwnProperty(r)&&(n=JSON.stringify(this.requests[r].request),n===JSON.stringify(s.request))){this.requests[r].validForGroup.push(t),s.isDuplicated=!0,delete s.validForGroup;break}return s},handleRequests:function(){var t=this,i=Object.keys(this.requests).length;if(this.helper.executeCallback.call(this,this.options.callback.onSendRequest,[this.node,this.query])===!1)return void(this.isGenerated=null);for(var o in this.requests)this.requests.hasOwnProperty(o)&&(this.requests[o].isDuplicated||!function(o,s){if("function"==typeof t.options.source[o].url[0]){var n=t.options.source[o].url[0].call(t,t.query);if(s.request=e.extend(!0,s.request,n),"object"!=typeof s.request||!s.request.url)return;n.beforeSend&&(t.requests[o].extra.beforeSend=n.beforeSend)}var r,a=!1;if(~s.request.url.indexOf("{{query}}")&&(a||(s=e.extend(!0,{},s),a=!0),s.request.url=s.request.url.replace("{{query}}",t.query.sanitize())),s.request.data)for(var l in s.request.data)if(s.request.data.hasOwnProperty(l)&&~String(s.request.data[l]).indexOf("{{query}}")){a||(s=e.extend(!0,{},s),a=!0),s.request.data[l]=s.request.data[l].replace("{{query}}",t.query.sanitize());break}e.ajax(s.request).done(function(e,o,n){for(var a,l=0;l<s.validForGroup.length;l++)r=t.requests[s.validForGroup[l]],r.extra.callback.done instanceof Function&&(a=r.extra.callback.done(e,o,n),e=a instanceof Array&&a||e),t.populateSource(e,r.extra.group,r.extra.path),i-=1,0===i&&t.helper.executeCallback.call(t,t.options.callback.onReceiveRequest,[t.node,t.query])}).fail(function(e,i,o){for(var n=0;n<s.validForGroup.length;n++)r=t.requests[s.validForGroup[n]],r.extra.callback.fail instanceof Function&&r.extra.callback.fail(e,i,o)}).then(function(e,i){for(var o=0;o<s.validForGroup.length;o++)r=t.requests[s.validForGroup[o]],r.extra.callback.then instanceof Function&&r.extra.callback.then(e,i)}).always(function(e,i,o){for(var n=0;n<s.validForGroup.length;n++)r=t.requests[s.validForGroup[n]],r.extra.callback.always instanceof Function&&r.extra.callback.always(e,i,o)})}(o,this.requests[o]))},populateSource:function(e,i,o){var s=this,n=this.options.source[i],r=n.url&&n.data;e="string"==typeof o?this.helper.namespace(o,e):e,e instanceof Array||(e=[]),r&&("function"==typeof r&&(r=r()),r instanceof Array&&(e=e.concat(r)));for(var a,l=n.display?"compiled"===n.display[0]?n.display[1]:n.display[0]:"compiled"===this.options.display[0]?this.options.display[1]:this.options.display[0],h=0;h<e.length;h++)"string"==typeof e[h]&&(a={},a[l]=e[h],e[h]=a),e[h].group=i;if(this.options.correlativeTemplate){var u=n.template||this.options.template,c="";if("function"==typeof u&&(u=u()),u){if(this.options.correlativeTemplate instanceof Array)for(var h=0;h<this.options.correlativeTemplate.length;h++)c+="{{"+this.options.correlativeTemplate[h]+"}} ";else c=u.replace(/<.+?>/g,"");for(var h=0;h<e.length;h++)e[h].compiled=c.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,i){return s.helper.namespace(i,e[h],"get","")}).trim();n.display?~n.display.indexOf("compiled")||n.display.unshift("compiled"):~this.options.display.indexOf("compiled")||this.options.display.unshift("compiled")}else;}if(this.options.callback.onPopulateSource&&(e=this.helper.executeCallback.call(this,this.options.callback.onPopulateSource,[this.node,e,i,o])),this.tmpSource[i]=e,this.options.cache&&!t[this.options.cache].getItem("TYPEAHEAD_"+this.node.selector+":"+i)){this.options.callback.onCacheSave&&(e=this.helper.executeCallback.call(this,this.options.callback.onCacheSave,[this.node,e,i,o]));var p=JSON.stringify({data:e,ttl:(new Date).getTime()+this.options.ttl});this.options.compression&&(p=LZString.compressToUTF16(p)),t[this.options.cache].setItem("TYPEAHEAD_"+this.node.selector+":"+i,p)}this.incrementGeneratedGroup()},incrementGeneratedGroup:function(){if(this.generatedGroupCount+=1,this.groupCount===this.generatedGroupCount){this.isGenerated=!0,this.xhr={};for(var t=Object.keys(this.options.source),e=0;e<t.length;e++)this.source[t[e]]=this.tmpSource[t[e]];this.tmpSource={},this.node.trigger("dynamic"+o)}},navigate:function(t){if(this.helper.executeCallback.call(this,this.options.callback.onNavigateBefore,[this.node,this.query,t]),27===t.keyCode)return t.preventDefault(),void(this.query.length?(this.node.val(""),this.node.trigger("input"+o)):this.node.blur());if(this.isGenerated&&this.result.length){var e=this.resultContainer.find("> ul > li:not([data-search-group])"),i=e.filter(".active"),s=i[0]&&e.index(i)||null,n=null;if(13===t.keyCode)return t.preventDefault(),void(i.length>0?i.find("a:first")[0].click():this.node.closest("form").submit());if(39===t.keyCode)return void(s?e.eq(s).find("a:first")[0].click():this.options.hint&&""!==this.hint.container.val()&&this.helper.getCaret(this.node[0])>=this.query.length&&e.find('a[data-index="'+this.hintIndex+'"]')[0].click());e.length>0&&i.removeClass("active"),38===t.keyCode?(t.preventDefault(),i.length>0?s-1>=0&&(n=s-1,e.eq(n).addClass("active")):(n=e.length-1,e.last().addClass("active"))):40===t.keyCode&&(t.preventDefault(),i.length>0?s+1<e.length&&(n=s+1,e.eq(n).addClass("active")):(n=0,e.first().addClass("active"))),t.preventInputChange&&~[38,40].indexOf(t.keyCode)&&this.buildHintLayout(null!==n&&n<this.result.length?[this.result[n]]:null),this.options.hint&&this.hint.container&&this.hint.container.css("color",t.preventInputChange?this.hint.css.color:null===n&&this.hint.css.color||this.hint.container.css("background-color")||"fff"),this.node.val(null===n||t.preventInputChange?this.rawQuery:this.result[n][this.result[n].matchedKey]),this.helper.executeCallback.call(this,this.options.callback.onNavigateAfter,[this.node,e,null!==n&&e.eq(n).find("a:first")||void 0,null!==n&&this.result[n]||void 0,this.query,t])}},searchResult:function(t){t||(this.item={}),this.resetLayout(),this.helper.executeCallback.call(this,this.options.callback.onSearch,[this.node,this.query])!==!1&&(this.query.length>=this.options.minLength&&this.searchResultData(),this.helper.executeCallback.call(this,this.options.callback.onResult,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]))},searchResultData:function(){var t,e,i,o,s,n,r,a,l,h,u,c,p=this,d=this.options.group&&"boolean"!=typeof this.options.group[0]?this.options.group[0]:"group",f=null,y=this.query.toLowerCase(),g=this.options.maxItemPerGroup,m=this.filters.dynamic&&!this.helper.isEmpty(this.filters.dynamic),v="function"==typeof this.options.matcher&&this.options.matcher;this.options.accent&&(y=this.helper.removeAccent.call(this,y));for(t in this.source)if(this.source.hasOwnProperty(t)&&(!this.filters.dropdown||"group"!==this.filters.dropdown.key||this.filters.dropdown.value===t)){n="undefined"!=typeof this.options.source[t].filter?this.options.source[t].filter:this.options.filter,a="function"==typeof this.options.source[t].matcher&&this.options.source[t].matcher||v;for(var b=0;b<this.source[t].length&&(!(this.result.length>=this.options.maxItem)||this.options.callback.onResult);b++)if(!m||this.dynamicFilter.validate.apply(this,[this.source[t][b]])){if(e=this.source[t][b],f="group"===d?t:e[d],f&&!this.result[f]&&(this.result[f]=[],this.resultCountPerGroup[f]=0),g&&"group"===d&&this.result[f].length>=g&&!this.options.callback.onResult)break;s=this.options.source[t].display||this.options.display;for(var k=0;k<s.length;k++){if("function"==typeof n){if(r=n.call(this,e,e[s[k]]),void 0===r)break;if(!r)continue;"object"==typeof r&&(e=r)}if(~[void 0,!0].indexOf(n)){if(o=e[s[k]],!o)continue;if(o=o.toString().toLowerCase(),this.options.accent&&(o=this.helper.removeAccent.call(this,o)),i=o.indexOf(y),this.options.correlativeTemplate&&"compiled"===s[k]&&0>i&&/\s/.test(y)){h=!0,u=y.split(" "),c=o;for(var C=0;C<u.length;C++)if(""!==u[C]){if(!~c.indexOf(u[C])){h=!1;break}c=c.replace(u[C],"")}}if(0>i&&!h)continue;if(this.options.offset&&0!==i)continue;if(this.options.source[t].ignore&&this.options.source[t].ignore.test(o))continue;if(a){if(l=a.call(this,e,e[s[k]]),void 0===l)break;if(!l)continue;"object"==typeof l&&(e=l)}}if(!this.filters.dropdown||this.filters.dropdown.value==e[this.filters.dropdown.key]){if(this.resultCount++,this.resultCountPerGroup[f]++,this.resultItemCount<this.options.maxItem){if(g&&this.result[f].length>=g)break;e.matchedKey=s[k],this.result[f].push(e),this.resultItemCount++}break}}if(!this.options.callback.onResult){if(this.resultItemCount>=this.options.maxItem)break;if(g&&this.result[f].length>=g&&"group"===d)break}}}if(this.options.order){var x,s=[];for(var t in this.result)if(this.result.hasOwnProperty(t)){for(var k=0;k<this.result[t].length;k++)x=this.options.source[this.result[t][k].group].display||this.options.display,~s.indexOf(x[0])||s.push(x[0]);console.log(this.result[t]),console.log(s),console.log("asc"===p.options.order),this.result[t].sort(p.helper.sort(s,"asc"===p.options.order,function(t){return t.toString().toUpperCase()}))}}var q,w=[];q="function"==typeof this.options.groupOrder?this.options.groupOrder.apply(this,[this.node,this.query,this.result,this.resultCount,this.resultCountPerGroup]):this.options.groupOrder instanceof Array?this.options.groupOrder:"string"==typeof this.options.groupOrder&&~["asc","desc"].indexOf(this.options.groupOrder)?Object.keys(this.result).sort(p.helper.sort([],"asc"===p.options.groupOrder,function(t){return t.toString().toUpperCase()})):Object.keys(this.result);for(var k=0;k<q.length;k++)w=w.concat(this.result[q[k]]||[]);this.result=w},buildLayout:function(){if(this.buildHtmlLayout(),this.buildBackdropLayout(),this.buildHintLayout(),this.options.callback.onLayoutBuiltBefore){var t=this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltBefore,[this.node,this.query,this.result,this.resultHtml]);t instanceof jQuery&&(this.resultHtml=t)}this.resultHtml&&this.resultContainer.html(this.resultHtml),this.options.callback.onLayoutBuiltAfter&&this.helper.executeCallback.call(this,this.options.callback.onLayoutBuiltAfter,[this.node,this.query,this.result])},buildHtmlLayout:function(){if(this.options.resultContainer!==!1){this.resultContainer||(this.resultContainer=e("<div/>",{"class":this.options.selector.result}),this.container.append(this.resultContainer));var t=this.query.toLowerCase();this.options.accent&&(t=this.helper.removeAccent.call(this,t));var i=this;this.resultHtml=e("<ul/>",{"class":this.options.selector.list+(i.helper.isEmpty(i.result)?" empty":""),html:function(){if(i.options.emptyTemplate&&i.helper.isEmpty(i.result)){var o="function"==typeof i.options.emptyTemplate?i.options.emptyTemplate.call(i,i.query):i.options.emptyTemplate.replace(/\{\{query}}/gi,i.query.sanitize());return o instanceof jQuery&&"LI"===o[0].nodeName?o:e("<li/>",{"class":i.options.selector.empty,html:e("<a/>",{href:"javascript:;",html:o})})}for(var s in i.result)i.result.hasOwnProperty(s)&&!function(o,s,n){var r,a,l,h,u=s.group,c=[],p=i.options.source[s.group].display||i.options.display,d=i.options.source[s.group].href||i.options.href;i.options.group&&(i.options.group[1]?"function"==typeof i.options.group[1]?u=i.options.group[1](s):"string"==typeof i.options.group[1]&&(u=i.options.group[1].replace(/(\{\{group}})/gi,s[i.options.group[0]]||u)):"boolean"!=typeof i.options.group[0]&&s[i.options.group[0]]&&(u=s[i.options.group[0]]),e(n).find('li[data-search-group="'+u+'"]')[0]||e(n).append(e("<li/>",{"class":i.options.selector.group,html:e("<a/>",{href:"javascript:;",html:u}),"data-search-group":u}))),r=e("<li/>",{"class":i.options.selector.item,html:e("<a/>",{href:function(){return d&&("string"==typeof d?d=d.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(t,e,o){var n=i.helper.namespace(e,s,"get","");return o&&"slugify"===o&&(n=i.helper.slugify.call(i,n)),n}):"function"==typeof d&&(d=d(s)),s.href=d),d||"javascript:;"},"data-group":u,"data-index":o,html:function(){if(h=s.group&&i.options.source[s.group].template||i.options.template)"function"==typeof h&&(h=h.call(i,i.query,s)),a=h.replace(/\{\{([\w\-\.]+)(?:\|(\w+))?}}/g,function(e,o,n){var r=String(i.helper.namespace(o,s,"get","")).sanitize();return n&&"raw"===n||i.options.highlight===!0&&t&&~p.indexOf(o)&&(r=i.helper.highlight.call(i,r,t.split(" "),i.options.accent)),r});else{for(var o=0;o<p.length;o++)c.push(s[p[o]]);a='<span class="'+i.options.selector.display+'">'+String(c.join(" ")).sanitize()+"</span>"}(i.options.highlight===!0&&t&&!h||"any"===i.options.highlight)&&(a=i.helper.highlight.call(i,a,t.split(" "),i.options.accent)),e(this).append(a)},click:function(t){return i.options.mustSelectItem&&i.helper.isEmpty(s)?void t.preventDefault():(i.item=s,void(i.helper.executeCallback.call(i,i.options.callback.onClickBefore,[i.node,e(this),s,t])!==!1&&(t.originalEvent&&t.originalEvent.defaultPrevented||t.isDefaultPrevented()||(i.query=i.rawQuery=s[s.matchedKey].toString(),i.node.val(i.query).focus(),i.searchResult(!0),i.buildLayout(),i.hideLayout(),i.helper.executeCallback.call(i,i.options.callback.onClickAfter,[i.node,e(this),s,t])))))},mouseenter:function(t){e(this).closest("ul").find("li.active").removeClass("active"),e(this).closest("li").addClass("active"),i.helper.executeCallback.call(i,i.options.callback.onMouseEnter,[i.node,e(this),s,t])},mouseleave:function(t){e(this).closest("li").removeClass("active"),i.helper.executeCallback.call(i,i.options.callback.onMouseLeave,[i.node,e(this),s,t])}})}),i.options.group?(l=e(n).find('a[data-group="'+u+'"]:last').closest("li"),l[0]||(l=e(n).find('li[data-search-group="'+u+'"]')),e(r).insertAfter(l)):e(n).append(r)}(s,i.result[s],this)}})}},buildBackdropLayout:function(){this.options.backdrop&&(this.backdrop.container||(this.backdrop.css=e.extend({opacity:.6,filter:"alpha(opacity=60)",position:"fixed",top:0,right:0,bottom:0,left:0,"z-index":1040,"background-color":"#000"},this.options.backdrop),this.backdrop.container=e("<div/>",{"class":this.options.selector.backdrop,css:this.backdrop.css}).insertAfter(this.container)),this.container.addClass("backdrop").css({"z-index":this.backdrop.css["z-index"]+1,position:"relative"}))},buildHintLayout:function(t){if(this.options.hint){if(this.node[0].scrollWidth>Math.ceil(this.node.innerWidth()))return void(this.hint.container&&this.hint.container.val(""));var i=this,o="",t=t||this.result,s=this.query.toLowerCase();if(this.options.accent&&(s=this.helper.removeAccent.call(this,s)),this.hintIndex=null,this.query.length>=this.options.minLength){if(this.hint.container||(this.hint.css=e.extend({"border-color":"transparent",position:"absolute",top:0,display:"inline","z-index":-1,"float":"none",color:"silver","box-shadow":"none",cursor:"default","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"},this.options.hint),this.hint.container=e("<input/>",{type:this.node.attr("type"),"class":this.node.attr("class"),readonly:!0,unselectable:"on",tabindex:-1,click:function(){i.node.focus()}}).addClass(this.options.selector.hint).css(this.hint.css).insertAfter(this.node),this.node.parent().css({position:"relative"})),this.hint.container.css("color",this.hint.css.color),s)for(var n,r,a,l=0;l<t.length;l++){r=t[l].group,n=this.options.source[r].display||this.options.display;for(var h=0;h<n.length;h++)if(a=String(t[l][n[h]]).toLowerCase(),this.options.accent&&(a=this.helper.removeAccent.call(this,a)),0===a.indexOf(s)){o=String(t[l][n[h]]),this.hintIndex=l;break}if(null!==this.hintIndex)break}this.hint.container.val(o.length>0&&this.rawQuery+o.substring(this.query.length)||"")}}},buildDropdownLayout:function(){function t(t){"*"===t.value?delete this.filters.dropdown:this.filters.dropdown=t,this.container.removeClass("filter").find("."+this.options.selector.filterValue).html(t.display||t.value),this.node.trigger("dynamic"+o),this.node.focus()}if(this.options.dropdownFilter){var i=this,s="all";if("string"==typeof this.options.dropdownFilter)s=this.options.dropdownFilter;else if(this.options.dropdownFilter instanceof Array)for(var n=0;n<this.options.dropdownFilter.length;n++)if("*"===this.options.dropdownFilter[n].value&&this.options.dropdownFilter[n].display){s=this.options.dropdownFilter[n].display;break}e("<span/>",{"class":this.options.selector.filter,html:function(){e(this).append(e("<button/>",{type:"button","class":i.options.selector.filterButton,html:"<span class='"+i.options.selector.filterValue+"'>"+s+"</span> <span class='"+i.options.selector.dropdownCaret+"'></span>",click:function(t){t.stopPropagation(),i.container.toggleClass("filter");var s=o+"-dropdown-filter";e("html").off(s),i.container.hasClass("filter")&&e("html").one("click"+s+" touchstart"+s,function(){i.container.removeClass("filter")})}})),e(this).append(e("<ul/>",{"class":i.options.selector.dropdown,html:function(){var o=i.options.dropdownFilter;if(~["string","boolean"].indexOf(typeof i.options.dropdownFilter)){o=[];for(var s in i.options.source)i.options.source.hasOwnProperty(s)&&o.push({key:"group",value:s});o.push({key:"group",value:"*",display:"string"==typeof i.options.dropdownFilter&&i.options.dropdownFilter||"All"})}for(var n=0;n<o.length;n++)!function(o,s,n){(s.key||"*"===s.value)&&s.value&&("*"===s.value&&e(n).append(e("<li/>",{"class":"divider"})),e(n).append(e("<li/>",{html:e("<a/>",{href:"javascript:;",html:s.display||s.value,click:function(e){e.preventDefault(),t.apply(i,[s])}})})))}(n,o[n],this)}}))}}).insertAfter(i.container.find("."+i.options.selector.query))}},dynamicFilter:{isEnabled:!1,init:function(){this.options.dynamicFilter&&(this.dynamicFilter.bind.call(this),this.dynamicFilter.isEnabled=!0)},validate:function(t){var e,i,o=null,s=null;for(var n in this.filters.dynamic)if(this.filters.dynamic.hasOwnProperty(n)&&(i=~n.indexOf(".")?this.helper.namespace(n,t,"get"):t[n],"|"!==this.filters.dynamic[n].modifier||o||(o=i==this.filters.dynamic[n].value||!1),"&"===this.filters.dynamic[n].modifier)){if(i!=this.filters.dynamic[n].value){s=!1;break}s=!0}return e=o,null!==s&&(e=s,s===!0&&null!==o&&(e=o)),!!e},set:function(t,e){var i=t.match(/^([|&])?(.+)/);e?this.filters.dynamic[i[2]]={modifier:i[1]||"|",value:e}:delete this.filters.dynamic[i[2]],this.dynamicFilter.isEnabled&&(this.searchResult(),this.buildLayout())},bind:function(){for(var t,i=this,s=0;s<this.options.dynamicFilter.length;s++)t=this.options.dynamicFilter[s],"string"==typeof t.selector&&(t.selector=e(t.selector)),t.selector instanceof jQuery&&t.selector[0]&&t.key&&!function(t){t.selector.off(o).on("change"+o,function(){i.dynamicFilter.set.apply(i,[t.key,i.dynamicFilter.getValue(this)])}).trigger("change"+o)}(t)},getValue:function(t){var e;return"SELECT"===t.tagName?e=t.value:"INPUT"===t.tagName&&("checkbox"===t.type?e=t.checked&&t.getAttribute("value")||t.checked||null:"radio"===t.type&&t.checked&&(e=t.value)),e}},showLayout:function(){if(!this.container.hasClass("result")&&(this.result.length||this.options.emptyTemplate||this.options.backdropOnFocus)){var t=this;e("html").off(o).on("click"+o+" touchstart"+o,function(i){e(i.target).closest(t.container)[0]||t.hideLayout()}),this.container.addClass([this.result.length||this.options.emptyTemplate&&this.query.length>=this.options.minLength?"result ":"",this.options.hint&&this.query.length>=this.options.minLength?"hint":"",this.options.backdrop||this.options.backdropOnFocus?"backdrop":""].join(" ")),this.helper.executeCallback.call(this,this.options.callback.onShowLayout,[this.node,this.query])}},hideLayout:function(){(this.container.hasClass("result")||this.container.hasClass("backdrop"))&&(this.container.removeClass("result hint filter"+(this.options.backdropOnFocus&&e(this.node).is(":focus")?"":" backdrop")),this.options.backdropOnFocus&&this.container.hasClass("backdrop")||(e("html").off(o),this.helper.executeCallback.call(this,this.options.callback.onHideLayout,[this.node,this.query])))},resetLayout:function(){this.result={},this.resultCount=0,this.resultCountPerGroup={},this.resultItemCount=0,this.resultHtml=null,this.options.hint&&this.hint.container&&this.hint.container.val("")},__construct:function(){this.extendOptions(),this.unifySourceFormat()&&(this.dynamicFilter.init.apply(this),this.init(),this.delegateEvents(),this.buildDropdownLayout(),this.helper.executeCallback.call(this,this.options.callback.onReady,[this.node]))},helper:{isEmpty:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},removeAccent:function(t){if("string"==typeof t){var e=this.options.accent||s;return t=t.toLowerCase().replace(new RegExp("["+e.from+"]","g"),function(t){return e.to[e.from.indexOf(t)]})}},slugify:function(t){return t=String(t),""!==t&&(t=this.helper.removeAccent.call(this,t),t=t.replace(/[^-a-z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")),t},sort:function(t,e,i){var o=function(e){for(var o=0;o<t.length;o++)if("undefined"!=typeof e[t[o]])return i(e[t[o]]);return e};return e=[-1,1][+!!e],function(t,i){return t=o(t),i=o(i),e*((t>i)-(i>t))}},replaceAt:function(t,e,i,o){return t.substring(0,e)+o+t.substring(e+i)},highlight:function(t,e,i){t=String(t);var o=i&&this.helper.removeAccent.call(this,t)||t,s=[];e instanceof Array||(e=[e]),e.sort(function(t,e){return e.length-t.length});for(var n=e.length-1;n>=0;n--)""!==e[n].trim()?e[n]=e[n].replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e.splice(n,1);o.replace(new RegExp("(?:"+e.join("|")+")(?!([^<]+)?>)","gi"),function(t,e,i){s.push({offset:i,length:t.length})});for(var n=s.length-1;n>=0;n--)t=this.helper.replaceAt(t,s[n].offset,s[n].length,"<strong>"+t.substr(s[n].offset,s[n].length)+"</strong>");return t},getCaret:function(t){if(t.selectionStart)return t.selectionStart;if(document.selection){t.focus();var e=document.selection.createRange();if(null==e)return 0;var i=t.createTextRange(),o=i.duplicate();return i.moveToBookmark(e.getBookmark()),o.setEndPoint("EndToStart",i),o.text.length}return 0},executeCallback:function(e,i){if(e){var o;if("function"==typeof e)o=e;else if(("string"==typeof e||e instanceof Array)&&("string"==typeof e&&(e=[e,[]]),o=this.helper.namespace(e[0],t),"function"!=typeof o))return;return o.apply(this,(e[1]||[]).concat(i?i:[]))}},namespace:function(e,i,o,s){if("string"!=typeof e||""===e)return!1;for(var n=e.split("."),r=i||t,o=o||"get",a=s||{},l="",h=0,u=n.length;u>h;h++){if(l=n[h],"undefined"==typeof r[l]){if(~["get","delete"].indexOf(o))return"undefined"!=typeof s?s:void 0;r[l]={}}if(~["set","create","delete"].indexOf(o)&&h===u-1){if("set"!==o&&"create"!==o)return delete r[l],!0;r[l]=a}r=r[l]}return r},typeWatch:function(){var t=0;return function(e,i){clearTimeout(t),t=setTimeout(e,i)}}()}},e.fn.typeahead=e.typeahead=function(t){return a.typeahead(this,t)};var a={typeahead:function(i,o){if(o&&o.source&&"object"==typeof o.source){if("function"==typeof i){if(!o.input)return;i=e(o.input)}if(i.length&&"INPUT"===i[0].nodeName)return t.Typeahead[i.selector||o.input]=new r(i,o)}}};return"sanitize"in String.prototype||(String.prototype.sanitize=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return this.replace(/[&<>"'\/]/g,function(e){return t[e]})}),t.console=t.console||{log:function(){}},"trim"in String.prototype||(String.prototype.trim=function(){return this.replace(/^\s+/,"").replace(/\s+$/,"");
}),"indexOf"in Array.prototype||(Array.prototype.indexOf=function(t,e){void 0===e&&(e=0),0>e&&(e+=this.length),0>e&&(e=0);for(var i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1}),Object.keys||(Object.keys=function(t){var e,i=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&i.push(e);return i}),r});